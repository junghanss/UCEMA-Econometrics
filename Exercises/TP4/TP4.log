----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
      name:  <unnamed>
       log:  C:\Users\JUAN\Google Drive\Universidad\UCEMA\Econometria\TP\TP4\TP4.log
  log type:  text
 opened on:   4 Jun 2020, 12:11:58

. *****TP4: Ejercicio 1
. import excel "datosTP4.xls", sheet(Ej1) firstrow

. *****(A): Yi=B0+B1*X1i+B2*X2i+u
. *****(B): Correlacoines simple y parcial:
. *Simple: Y respecto X1
. corr Yi X1i X2i
(obs=12)

             |       Yi      X1i      X2i
-------------+---------------------------
          Yi |   1.0000
         X1i |  -0.9429   1.0000
         X2i |   0.7172  -0.5177   1.0000


. *Parcial: Y respecto X1, dejando constante X2
. pcorr Yi X1i X2i 
(obs=12)

Partial and semipartial correlations of Yi with

               Partial   Semipartial      Partial   Semipartial   Significance
   Variable |    Corr.         Corr.      Corr.^2       Corr.^2          Value
------------+-----------------------------------------------------------------
        X1i |  -0.9587       -0.6681       0.9192        0.4464         0.0000
        X2i |   0.8038        0.2677       0.6461        0.0717         0.0029

. *****(C): regresamos
. reg Yi X1i X2i

      Source |       SS       df       MS              Number of obs =      12
-------------+------------------------------           F(  2,     9) =  110.13
       Model |  6052.69037     2  3026.34518           Prob > F      =  0.0000
    Residual |  247.309632     9   27.478848           R-squared     =  0.9607
-------------+------------------------------           Adj R-squared =  0.9520
       Total |        6300    11  572.727273           Root MSE      =   5.242

------------------------------------------------------------------------------
          Yi |      Coef.   Std. Err.      t    P>|t|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
         X1i |  -1.306707   .1291669   -10.12   0.000    -1.598903   -1.014511
         X2i |   11.08926   2.735488     4.05   0.003     4.901155    17.27736
       _cons |   116.9866   24.36439     4.80   0.001     61.87056    172.1027
------------------------------------------------------------------------------

. *Intepretar refiere a definir CADA coeficiente de la regresion
. *Coef X1i muestra que ante una variacion unitaria de X1, la variable explicada Yi se reducirá -1.306, manteniendo el resto constante, para un nivel de significancia de "".
. *****(D): F = (SEC/(k-1))/(SCR/(n-k)) que se aproxima a F(k-1;n-k)
. scalar SEC = e(mss)

. scalar SCR = e(rss)

. scalar k1 = e(df_m) /*pedimos los df del modelo*/

. scalar nk = e(df_r) /*pedimos los df del residuo*/

. scalar F = (SEC/k1)/(SCR/nk)

. di Ftail(k1, nk, F) /*Ftail es para obtener el p-valor del estadistico con k1 arriba, nk abajo*/
4.705e-07

. *Obtener estadistico F a partir del cual rechazar
. di invFtail(k1,nk,0.05) /*A partir de 4.25 es zona de rechazo, lo comparamos con nuestro valor F*/
4.2564947

. di F /*Vemos que el valor estimado coincide con el de la tabla de regresion, PERO, cae en zona de rechazo*/
110.13363

. *****(E): 
. scalar B0 = _b[_cons]

. scalar B1 = _b[X1i]

. scalar B2 = _b[X2i]

. scalar D0 = _se[_cons] /*para hallar desvio estandar*/

. scalar D1 = _se[X1i]

. scalar D2 = _se[X2i]

. scalar t0 = (B0-0)/D0 /*Estadistico t*/ 

. scalar t1 = (B1-0)/D1

. scalar t2 = (B2-0)/D2

. di t0, t1, t2
4.8015418 -10.116425 4.0538505

. di invttail(nk, 0.05) /*Estimo el valor t a partir del cual definimos area de rechazo, con df: n-k*/
1.8331129

. di 1-ttail(nk,t1) /*para pedir el p-valor, 1 - el valor*/
1.625e-06

. *****(F): Para calcular R2
. scalar R2 = e(mss)/e(mss)+e(rss)

. di R2
248.30963

. di e(r2)
.9607445

. *****(G): 
. scalar t = invttail(nk,0.025) /*Primero calculamos el estadistico t para el intervalo*/

. scalar B0s = B0+t*D0 /*S:Superior*/

. scalar B0i = B0-t*D0 /*I:Inferior*/

. scalar B1s = B1+t*D1

. scalar B1i = B1-t*D1

. scalar B2s = B2+t*D2

. scalar B2i = B2-t*D2

. di B0i, B0s
61.870558 172.10272

. di B1i, B1s
-1.5989028 -1.0145112

. di B2i, B2s
4.9011554 17.277362

. 
. *******Ejercicio 3 *******
. use "wage2.dta", clear

. set more off

. *****(A): educ = B0 + B1*Meduc + B2*feduc + B3*sibs + u
. *****(B): por suposicion pensaremos: meduc + ; feduc + ; sibs -
. *****(C): estadisticas descriptivas
. sum educ sibs meduc feduc, detail

                            educ
-------------------------------------------------------------
      Percentiles      Smallest
 1%            9              9
 5%           11              9
10%           12              9       Obs                 935
25%           12              9       Sum of Wgt.         935

50%           12                      Mean           13.46845
                        Largest       Std. Dev.      2.196654
75%           16             18
90%           17             18       Variance       4.825288
95%           18             18       Skewness       .5477959
99%           18             18       Kurtosis       2.262651

                            sibs
-------------------------------------------------------------
      Percentiles      Smallest
 1%            0              0
 5%            0              0
10%            1              0       Obs                 935
25%            1              0       Sum of Wgt.         935

50%            2                      Mean           2.941176
                        Largest       Std. Dev.      2.306254
75%            4             13
90%            6             13       Variance       5.318806
95%            7             14       Skewness       1.437791
99%           11             14       Kurtosis       5.741907

                            meduc
-------------------------------------------------------------
      Percentiles      Smallest
 1%            2              0
 5%            6              0
10%            7              0       Obs                 857
25%            8              1       Sum of Wgt.         857

50%           12                      Mean           10.68261
                        Largest       Std. Dev.      2.849756
75%           12             18
90%           14             18       Variance       8.121111
95%           16             18       Skewness      -.4968687
99%           17             18       Kurtosis       3.931563

                            feduc
-------------------------------------------------------------
      Percentiles      Smallest
 1%            2              0
 5%            5              2
10%            6              2       Obs                 741
25%            8              2       Sum of Wgt.         741

50%           10                      Mean           10.21727
                        Largest       Std. Dev.        3.3007
75%           12             18
90%           14             18       Variance       10.89462
95%           16             18       Skewness      -.0433809
99%           18             18       Kurtosis       2.963792

. codebook educ sibs meduc feduc

----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
educ                                                                                                                                                                                                             (unlabeled)
----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------

                  type:  numeric (byte)

                 range:  [9,18]                       units:  1
         unique values:  10                       missing .:  0/935

                  mean:   13.4684
              std. dev:   2.19665

           percentiles:        10%       25%       50%       75%       90%
                                12        12        12        16        17

----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
sibs                                                                                                                                                                                                             (unlabeled)
----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------

                  type:  numeric (byte)

                 range:  [0,14]                       units:  1
         unique values:  15                       missing .:  0/935

                  mean:   2.94118
              std. dev:   2.30625

           percentiles:        10%       25%       50%       75%       90%
                                 1         1         2         4         6

----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
meduc                                                                                                                                                                                                            (unlabeled)
----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------

                  type:  numeric (byte)

                 range:  [0,18]                       units:  1
         unique values:  19                       missing .:  78/935

                  mean:   10.6826
              std. dev:   2.84976

           percentiles:        10%       25%       50%       75%       90%
                                 7         8        12        12        14

----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
feduc                                                                                                                                                                                                            (unlabeled)
----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------

                  type:  numeric (byte)

                 range:  [0,18]                       units:  1
         unique values:  18                       missing .:  194/935

                  mean:   10.2173
              std. dev:    3.3007

           percentiles:        10%       25%       50%       75%       90%
                                 6         8        10        12        14

. *****(G):
. graph matrix educ sibs feduc meduc

. corr educ sibs feduc meduc
(obs=722)

             |     educ     sibs    feduc    meduc
-------------+------------------------------------
        educ |   1.0000
        sibs |  -0.2128   1.0000
       feduc |   0.4271  -0.2269   1.0000
       meduc |   0.3718  -0.2913   0.5765   1.0000


. *****(D): Pasa bien el test F y los tests t, a pesar de tener un R2 bajo
. reg educ sibs feduc meduc

      Source |       SS       df       MS              Number of obs =     722
-------------+------------------------------           F(  3,   718) =   65.20
       Model |  772.281437     3  257.427146           Prob > F      =  0.0000
    Residual |  2834.93324   718  3.94837499           R-squared     =  0.2141
-------------+------------------------------           Adj R-squared =  0.2108
       Total |  3607.21468   721  5.00307168           Root MSE      =  1.9871

------------------------------------------------------------------------------
        educ |      Coef.   Std. Err.      t    P>|t|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
        sibs |  -.0936359   .0344713    -2.72   0.007    -.1613124   -.0259594
       feduc |   .2100041   .0274748     7.64   0.000     .1560635    .2639447
       meduc |   .1307872    .032689     4.00   0.000     .0666098    .1949646
       _cons |   10.36426   .3585001    28.91   0.000     9.660422    11.06809
------------------------------------------------------------------------------

. *****():
. scalar BS = _b[sibs]

. scalar sibs1 = -1 / BS /*Para saber la cantidad de hermanos que se necesita para perder un año de educ*/

. di "numero de hermanos necesarios para perder un año:    ", sibs1
numero de hermanos necesarios para perder un año:     10.679661

. 
. *****(E): 
. test sibs feduc meduc

 ( 1)  sibs = 0
 ( 2)  feduc = 0
 ( 3)  meduc = 0

       F(  3,   718) =   65.20
            Prob > F =    0.0000

. test sibs feduc meduc, mtest /*mtest: muestra el valor de prob P*. Test irrestricto*/

 ( 1)  sibs = 0
 ( 2)  feduc = 0
 ( 3)  meduc = 0

---------------------------------------
       |   F(df,718)     df       p
-------+-------------------------------
  (1)  |        7.38      1     0.0068 #
  (2)  |       58.42      1     0.0000 #
  (3)  |       16.01      1     0.0001 #
-------+-------------------------------
  all  |       65.20      3     0.0000
---------------------------------------
                  # unadjusted p-values

. 
. *****(I): Prediccion
. reg educ sibs feduc meduc

      Source |       SS       df       MS              Number of obs =     722
-------------+------------------------------           F(  3,   718) =   65.20
       Model |  772.281437     3  257.427146           Prob > F      =  0.0000
    Residual |  2834.93324   718  3.94837499           R-squared     =  0.2141
-------------+------------------------------           Adj R-squared =  0.2108
       Total |  3607.21468   721  5.00307168           Root MSE      =  1.9871

------------------------------------------------------------------------------
        educ |      Coef.   Std. Err.      t    P>|t|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
        sibs |  -.0936359   .0344713    -2.72   0.007    -.1613124   -.0259594
       feduc |   .2100041   .0274748     7.64   0.000     .1560635    .2639447
       meduc |   .1307872    .032689     4.00   0.000     .0666098    .1949646
       _cons |   10.36426   .3585001    28.91   0.000     9.660422    11.06809
------------------------------------------------------------------------------

. scalar A = _b[_cons] + _b[sibs]*0 + _b[meduc]*12 + _b[feduc]*12

. scalar B = _b[_cons] + _b[sibs]*2 + _b[meduc]*14 + _b[feduc]*16

. di A
14.453751

. di B
15.36807

. /*Atencion: Son valores resultados en promedio, manteniendo todo lo demas constante*/
. mfx compute, at(meduc=12, feduc=12, sibs=0)

Marginal effects after regress
      y  = Fitted values (predict)
         =  14.453751
------------------------------------------------------------------------------
variable |      dy/dx    Std. Err.     z    P>|z|  [    95% C.I.   ]      X
---------+--------------------------------------------------------------------
    sibs |  -.0936359      .03447   -2.72   0.007  -.161198 -.026074         0
   feduc |   .2100041      .02747    7.64   0.000   .156154  .263854        12
   meduc |   .1307872      .03269    4.00   0.000   .066718  .194856        12
------------------------------------------------------------------------------

. mfx compute, at(meduc=14, feduc=16, sibs=2)

Marginal effects after regress
      y  = Fitted values (predict)
         =   15.36807
------------------------------------------------------------------------------
variable |      dy/dx    Std. Err.     z    P>|z|  [    95% C.I.   ]      X
---------+--------------------------------------------------------------------
    sibs |  -.0936359      .03447   -2.72   0.007  -.161198 -.026074         2
   feduc |   .2100041      .02747    7.64   0.000   .156154  .263854        16
   meduc |   .1307872      .03269    4.00   0.000   .066718  .194856        14
------------------------------------------------------------------------------

. 
. ******Bonus track: ejemplos de test *******
. reg educ sibs feduc meduc

      Source |       SS       df       MS              Number of obs =     722
-------------+------------------------------           F(  3,   718) =   65.20
       Model |  772.281437     3  257.427146           Prob > F      =  0.0000
    Residual |  2834.93324   718  3.94837499           R-squared     =  0.2141
-------------+------------------------------           Adj R-squared =  0.2108
       Total |  3607.21468   721  5.00307168           Root MSE      =  1.9871

------------------------------------------------------------------------------
        educ |      Coef.   Std. Err.      t    P>|t|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
        sibs |  -.0936359   .0344713    -2.72   0.007    -.1613124   -.0259594
       feduc |   .2100041   .0274748     7.64   0.000     .1560635    .2639447
       meduc |   .1307872    .032689     4.00   0.000     .0666098    .1949646
       _cons |   10.36426   .3585001    28.91   0.000     9.660422    11.06809
------------------------------------------------------------------------------

. test meduc=0 /*Solo para testear (F) si el caso de que la meduc fuera 0*/

 ( 1)  meduc = 0

       F(  1,   718) =   16.01
            Prob > F =    0.0001

. test meduc=feduc /*(H0) feduc + meduc = 0*/

 ( 1)  - feduc + meduc = 0

       F(  1,   718) =    2.24
            Prob > F =    0.1353

. test 5*meduc=feduc /*al 5% se rechaza de que sean iguales, al 1 no*/

 ( 1)  - feduc + 5*meduc = 0

       F(  1,   718) =    6.08
            Prob > F =    0.0139

. test (meduc=0) (meduc=feduc), mtest /*ademas del resultado individual, nos da el resultado global*/

 ( 1)  meduc = 0
 ( 2)  - feduc + meduc = 0

---------------------------------------
       |   F(df,718)     df       p
-------+-------------------------------
  (1)  |       16.01      1     0.0001 #
  (2)  |        2.24      1     0.1353 #
-------+-------------------------------
  all  |       77.11      2     0.0000
---------------------------------------
                  # unadjusted p-values

. 
. log close
      name:  <unnamed>
       log:  C:\Users\JUAN\Google Drive\Universidad\UCEMA\Econometria\TP\TP4\TP4.log
  log type:  text
 closed on:   4 Jun 2020, 12:12:01
----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
