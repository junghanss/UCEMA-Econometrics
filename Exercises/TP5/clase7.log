----------------------------------------------------------------------------------------------------------
      name:  <unnamed>
       log:  C:\Users\JUAN\Google Drive\Universidad\UCEMA\Econometria\TP\TP5\clase7.log
  log type:  text
 opened on:  26 Jul 2020, 18:40:23

. **Multicolinealidad**
. import excel "datosTP5.xls", firstrow sheet(Ej 2)

. reg Consumo Ingreso Riqueza

      Source |       SS       df       MS              Number of obs =      10
-------------+------------------------------           F(  2,     7) =   92.40
       Model |  8565.55407     2  4282.77704           Prob > F      =  0.0000
    Residual |  324.445926     7   46.349418           R-squared     =  0.9635
-------------+------------------------------           Adj R-squared =  0.9531
       Total |        8890     9  987.777778           Root MSE      =   6.808

------------------------------------------------------------------------------
     Consumo |      Coef.   Std. Err.      t    P>|t|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
     Ingreso |   .9415373   .8228983     1.14   0.290    -1.004308    2.887383
     Riqueza |  -.0424345   .0806645    -0.53   0.615    -.2331757    .1483067
       _cons |   24.77473     6.7525     3.67   0.008     8.807609    40.74186
------------------------------------------------------------------------------

. /*Inferencia general de los resultados de la regresion:
> - Pocas observaciones (micronumerosidad)
> - Buen estadistico F (modelo significativo para explicar Y)
> - R2 alto
> - Mal estadistico t (var ingreso NO significativa)
> 
> La multico. puede deberse a:
> 1) Alta correlación lineal entre variables
> 2) Muestra pequeña (micronumerosidad)  */
. *Ahora vemos la tolerancia y el FIV (factor inflacionario de varianza):
. reg Ingreso Riqueza

      Source |       SS       df       MS              Number of obs =      10
-------------+------------------------------           F(  1,     8) = 3849.02
       Model |  32931.5534     1  32931.5534           Prob > F      =  0.0000
    Residual |  68.4466181     8  8.55582726           R-squared     =  0.9979
-------------+------------------------------           Adj R-squared =  0.9977
       Total |       33000     9  3666.66667           Root MSE      =   2.925

------------------------------------------------------------------------------
     Ingreso |      Coef.   Std. Err.      t    P>|t|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
     Riqueza |   .0979231   .0015784    62.04   0.000     .0942834    .1015629
       _cons |  -.3862708   2.897956    -0.13   0.897    -7.068968    6.296427
------------------------------------------------------------------------------

. scalar R2 = e(r2)  /*Sustraemos el R2*/

. scalar Tolerancia_Ingreso = 1-R2  /*Tolerancia: 1-R2*/

. scalar VIF = 1/Tolerancia_Ingreso  /*FIV= 1/Tolerance*/

. di Tolerancia_Ingreso, VIF
.00207414 482.12755

. 
. reg Riqueza Ingreso

      Source |       SS       df       MS              Number of obs =      10
-------------+------------------------------           F(  1,     8) = 3849.02
       Model |  3427202.73     1  3427202.73           Prob > F      =  0.0000
    Residual |  7123.27273     8  890.409091           R-squared     =  0.9979
-------------+------------------------------           Adj R-squared =  0.9977
       Total |     3434326     9  381591.778           Root MSE      =   29.84

------------------------------------------------------------------------------
     Riqueza |      Coef.   Std. Err.      t    P>|t|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
     Ingreso |   10.19091   .1642623    62.04   0.000      9.81212     10.5697
       _cons |   7.545455   29.47581     0.26   0.804    -60.42589     75.5168
------------------------------------------------------------------------------

. scalar R2=e(r2)

. scalar Tolerancia_Riqueza = 1-R2

. scalar VIF_2 = 1/Tolerancia_Riqueza

. 
. reg Consumo Ingreso Riqueza 

      Source |       SS       df       MS              Number of obs =      10
-------------+------------------------------           F(  2,     7) =   92.40
       Model |  8565.55407     2  4282.77704           Prob > F      =  0.0000
    Residual |  324.445926     7   46.349418           R-squared     =  0.9635
-------------+------------------------------           Adj R-squared =  0.9531
       Total |        8890     9  987.777778           Root MSE      =   6.808

------------------------------------------------------------------------------
     Consumo |      Coef.   Std. Err.      t    P>|t|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
     Ingreso |   .9415373   .8228983     1.14   0.290    -1.004308    2.887383
     Riqueza |  -.0424345   .0806645    -0.53   0.615    -.2331757    .1483067
       _cons |   24.77473     6.7525     3.67   0.008     8.807609    40.74186
------------------------------------------------------------------------------

. estat vif /*test predeterminado stata para ver si lo que hicimos manualmente está bien*/

    Variable |       VIF       1/VIF  
-------------+----------------------
     Ingreso |    482.13    0.002074
     Riqueza |    482.13    0.002074
-------------+----------------------
    Mean VIF |    482.13

. di Tolerancia_Ingreso
.00207414

. di Tolerancia_Riqueza
.00207414

. di VIF
482.12755

. di VIF_2
482.12755

. 
. /*Si nosotros quisieramos hacer inferencia y chequear significatividad:
> Podemos dividir a la varianza de las varaibles por el 1/VIF
> = Ejemplo: multiplicar 0.002074 el StdERr 0.822(^2)   */
. 
. reg Consumo Ingreso /* R2 muy alto == correlacion alta */

      Source |       SS       df       MS              Number of obs =      10
-------------+------------------------------           F(  1,     8) =  202.87
       Model |  8552.72727     1  8552.72727           Prob > F      =  0.0000
    Residual |  337.272727     8  42.1590909           R-squared     =  0.9621
-------------+------------------------------           Adj R-squared =  0.9573
       Total |        8890     9  987.777778           Root MSE      =   6.493

------------------------------------------------------------------------------
     Consumo |      Coef.   Std. Err.      t    P>|t|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
     Ingreso |   .5090909   .0357428    14.24   0.000     .4266678     .591514
       _cons |   24.45455   6.413817     3.81   0.005     9.664256    39.24483
------------------------------------------------------------------------------

. reg Consumo Riqueza

      Source |       SS       df       MS              Number of obs =      10
-------------+------------------------------           F(  1,     8) =  176.67
       Model |  8504.87666     1  8504.87666           Prob > F      =  0.0000
    Residual |  385.123344     8  48.1404181           R-squared     =  0.9567
-------------+------------------------------           Adj R-squared =  0.9513
       Total |        8890     9  987.777778           Root MSE      =  6.9383

------------------------------------------------------------------------------
     Consumo |      Coef.   Std. Err.      t    P>|t|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
     Riqueza |   .0497638    .003744    13.29   0.000     .0411301    .0583974
       _cons |   24.41104   6.874097     3.55   0.007     8.559349    40.26274
------------------------------------------------------------------------------

. *Correcion de varianza
. reg Consumo Ingreso Riqueza 

      Source |       SS       df       MS              Number of obs =      10
-------------+------------------------------           F(  2,     7) =   92.40
       Model |  8565.55407     2  4282.77704           Prob > F      =  0.0000
    Residual |  324.445926     7   46.349418           R-squared     =  0.9635
-------------+------------------------------           Adj R-squared =  0.9531
       Total |        8890     9  987.777778           Root MSE      =   6.808

------------------------------------------------------------------------------
     Consumo |      Coef.   Std. Err.      t    P>|t|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
     Ingreso |   .9415373   .8228983     1.14   0.290    -1.004308    2.887383
     Riqueza |  -.0424345   .0806645    -0.53   0.615    -.2331757    .1483067
       _cons |   24.77473     6.7525     3.67   0.008     8.807609    40.74186
------------------------------------------------------------------------------

. scalar VC = _se[Ingreso]^2 * Tolerancia_Ingreso /*multiplicar por tolerancia es lo mismo que dividir por
>  FIV*/

. /*Con el desvio estandar despues hacemos el test de hipotesis para ver si ==0*/
. scalar DC = VC^(1/2)

. scalar t = _b[Ingreso]/DC

. di t /*Un numero alto significativo*/
25.123051

. di ttail(9, t) /*Es significativa por estar cercano a cero. Pasamos de la regresion normal con un pvalor
>  0.290 a 0.000*/
6.026e-10

. 
. ****************************
. *********DUMMIES************
. clear all

. set more off

. cd "C:\Users\JUAN\Google Drive\Universidad\UCEMA\Econometria\TP\TP4"
C:\Users\JUAN\Google Drive\Universidad\UCEMA\Econometria\TP\TP4

. use "Voto.dta", clear 

. tab democa /*Show democrats, inferencia.. porcentajes*/

     democA |      Freq.     Percent        Cum.
------------+-----------------------------------
          0 |         77       44.51       44.51
          1 |         96       55.49      100.00
------------+-----------------------------------
      Total |        173      100.00

. sum votosA gastosA gastosB fortA /*Inferencia estadistica, media, max, etc.
> Para saber que UNIDADES se usan en esos datos, debemos sumar "votosA" al sum
> deducimos que es porcentual por intuicion*/

    Variable |       Obs        Mean    Std. Dev.       Min        Max
-------------+--------------------------------------------------------
      votosA |       173    50.50289    16.78476         16         84
     gastosA |       173    310.6111    280.9857         .3    1470.67
     gastosB |       173    305.0885     306.278        .93    1548.19
       fortA |       173    49.75723     9.98365         22         71

. reg votosA gastosA gastosB fortA democa 

      Source |       SS       df       MS              Number of obs =     173
-------------+------------------------------           F(  4,   168) =   70.43
       Model |  30355.2012     4  7588.80029           Prob > F      =  0.0000
    Residual |  18102.0474   168  107.750282           R-squared     =  0.6264
-------------+------------------------------           Adj R-squared =  0.6175
       Total |  48457.2486   172  281.728189           Root MSE      =   10.38

------------------------------------------------------------------------------
      votosA |      Coef.   Std. Err.      t    P>|t|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
     gastosA |   .0318006   .0032042     9.92   0.000      .025475    .0381263
     gastosB |  -.0300953   .0029571   -10.18   0.000    -.0359332   -.0242574
       fortA |   .5554211   .0921082     6.03   0.000     .3735825    .7372597
      democa |   9.382202   1.840633     5.10   0.000     5.748452    13.01595
       _cons |   16.96447   5.217739     3.25   0.001     6.663686    27.26525
------------------------------------------------------------------------------

. /*Analisis formal de los coeficientes:
> - Un aumento de 1 "unidad" en gastos (partido) A, influyen en +0.032 "unidades" (puntos porcentuales) vo
> tos A
> - Un aumento de 1 unidad en gastos (partido) B, influyeen en -0.03 puntos porcentuales votos A
> - Un aumento de 1 punto porcentual de fortaleza A, influye en 0.55 puntos porcentuales votos A
> - DUMMY: Si el estado es democrata, los votos MINIMOS del partido A serán de 9.38 puntos porcentuales ad
> icionales, respecto los estados no democratas
> Nota: los puntos porcentuales se utilizan cuando son modelos lineales pero las variables expresadas en t
> asas*/
. 
. 
. gen LvotosA =log(votosA)

. gen LgastosA =log(gastosA)

. gen LgastosB =log(gastosB)

. gen LfortA =log(fortA) /*no hacia falta pasarla a log pero es indistinto*/

. /*La variable dummy NO se debe pasar a logaritmos*/
. reg LvotosA LgastosA LgastosB LfortA

      Source |       SS       df       MS              Number of obs =     173
-------------+------------------------------           F(  3,   169) =  200.62
       Model |  18.0343497     3  6.01144991           Prob > F      =  0.0000
    Residual |  5.06388665   169  .029963826           R-squared     =  0.7808
-------------+------------------------------           Adj R-squared =  0.7769
       Total |  23.0982364   172  .134292072           Root MSE      =   .1731

------------------------------------------------------------------------------
     LvotosA |      Coef.   Std. Err.      t    P>|t|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
    LgastosA |   .1468789    .008586    17.11   0.000     .1299292    .1638285
    LgastosB |  -.1251776   .0084776   -14.77   0.000    -.1419132    -.108442
      LfortA |   .1792226   .0650733     2.75   0.007     .0507614    .3076839
       _cons |   3.044268   .2536755    12.00   0.000     2.543487    3.545049
------------------------------------------------------------------------------

. /*Analisis formal de los coeficientes:
> - Un aumento de 1 porciento en gastos A, influye en 0.13 porciento
> - Un aumetno de 1 porciento en gastos B, influye en -0.117 porciento
> - Un aumento de 1 porciento de fortA, aumenta votos A en 0.28 porciento
> - Si el distrito es democrata, los votos A tendrian 9.4 porciento extra (multiplicamos 0.094x100)
> La dummy sigue siendo lineal, por ende, forma funcional tipo "log-lin" */
. 
. tab district, gen(D) /*Para cada distrito nos genera una varaible nueva que toma 1 en caso que
> los datos correspondan a ese distrito, o 0 sino.. variables cualitativas */

   district |      Freq.     Percent        Cum.
------------+-----------------------------------
          1 |         21       12.14       12.14
          2 |         16        9.25       21.39
          3 |         16        9.25       30.64
          4 |         15        8.67       39.31
          5 |         14        8.09       47.40
          6 |         18       10.40       57.80
          7 |          8        4.62       62.43
          8 |          8        4.62       67.05
          9 |          6        3.47       70.52
         10 |          5        2.89       73.41
         11 |          4        2.31       75.72
         12 |          2        1.16       76.88
         13 |          2        1.16       78.03
         14 |          4        2.31       80.35
         15 |          4        2.31       82.66
         16 |          1        0.58       83.24
         17 |          3        1.73       84.97
         18 |          1        0.58       85.55
         19 |          4        2.31       87.86
         20 |          1        0.58       88.44
         21 |          1        0.58       89.02
         22 |          1        0.58       89.60
         23 |          4        2.31       91.91
         24 |          2        1.16       93.06
         26 |          1        0.58       93.64
         27 |          2        1.16       94.80
         30 |          2        1.16       95.95
         31 |          1        0.58       96.53
         32 |          1        0.58       97.11
         34 |          1        0.58       97.69
         36 |          1        0.58       98.27
         37 |          1        0.58       98.84
         40 |          1        0.58       99.42
         42 |          1        0.58      100.00
------------+-----------------------------------
      Total |        173      100.00

. 
. reg votosA gastosA gastosB fortA democa D1-D34
note: D22 omitted because of collinearity

      Source |       SS       df       MS              Number of obs =     173
-------------+------------------------------           F( 37,   135) =    8.58
       Model |  33997.2977    37  918.845883           Prob > F      =  0.0000
    Residual |  14459.9509   135  107.110747           R-squared     =  0.7016
-------------+------------------------------           Adj R-squared =  0.6198
       Total |  48457.2486   172  281.728189           Root MSE      =  10.349

------------------------------------------------------------------------------
      votosA |      Coef.   Std. Err.      t    P>|t|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
     gastosA |   .0337209   .0037313     9.04   0.000     .0263414    .0411003
     gastosB |  -.0316216   .0032214    -9.82   0.000    -.0379925   -.0252507
       fortA |   .5064328   .1015841     4.99   0.000     .3055307     .707335
      democa |   8.942979   2.062472     4.34   0.000     4.864045    13.02191
          D1 |   5.927765   10.68426     0.55   0.580    -15.20241    27.05794
          D2 |   9.044668   10.83092     0.84   0.405    -12.37556     30.4649
          D3 |   10.51211   10.85736     0.97   0.335     -10.9604    31.98463
          D4 |   12.24869   10.85179     1.13   0.261    -9.212808    33.71019
          D5 |   13.14655   10.82218     1.21   0.227      -8.2564    34.54949
          D6 |   8.938052   10.79317     0.83   0.409    -12.40751    30.28361
          D7 |   13.25893   11.06608     1.20   0.233    -8.626373    35.14422
          D8 |   7.071228   11.03968     0.64   0.523    -14.76186    28.90431
          D9 |   6.037959   11.34653     0.53   0.596    -16.40199    28.47791
         D10 |   13.56424   11.37339     1.19   0.235    -8.928817     36.0573
         D11 |    7.77949   11.80822     0.66   0.511    -15.57354    31.13252
         D12 |   3.209765   13.15565     0.24   0.808    -22.80807     29.2276
         D13 |  -1.651181   12.77768    -0.13   0.897    -26.92149    23.61913
         D14 |   6.484204   11.72009     0.55   0.581    -16.69453    29.66294
         D15 |   4.251539   11.59551     0.37   0.714    -18.68081    27.18389
         D16 |   25.47304   14.73896     1.73   0.086    -3.676087    54.62216
         D17 |   .4454793   12.20237     0.04   0.971    -23.68704      24.578
         D18 |  -9.944022   14.75546    -0.67   0.502    -39.12577    19.23773
         D19 |   11.22913   11.75397     0.96   0.341     -12.0166    34.47486
         D20 |   17.65443   14.73039     1.20   0.233    -11.47775     46.7866
         D21 |  -5.319901   14.78623    -0.36   0.720     -34.5625     23.9227
         D22 |          0  (omitted)
         D23 |   7.156381   11.65476     0.61   0.540    -15.89314     30.2059
         D24 |   2.177252   12.75374     0.17   0.865    -23.04572    27.40023
         D25 |  -1.517813   14.72463    -0.10   0.918    -30.63861    27.60298
         D26 |   1.852202   12.82916     0.14   0.885    -23.51992    27.22432
         D27 |   14.48507   12.77302     1.13   0.259    -10.77603    39.74617
         D28 |   11.32352   14.70934     0.77   0.443    -17.76703    40.41407
         D29 |   7.542184   14.82861     0.51   0.612    -21.78425    36.86861
         D30 |   14.89005   14.69994     1.01   0.313    -14.18191      43.962
         D31 |  -.7266121   14.80066    -0.05   0.961    -29.99776    28.54454
         D32 |     14.922   14.93791     1.00   0.320    -14.62059    44.46459
         D33 |  -14.28914   15.53351    -0.92   0.359    -45.00964    16.43136
         D34 |   3.856127   15.05558     0.26   0.798    -25.91918    33.63144
       _cons |   10.92709   12.00361     0.91   0.364    -12.81236    34.66653
------------------------------------------------------------------------------

. /*Vemos que D22 se omitio porque se empleó como base (n-1 variables dummy para n variables)
> Todas las v.dummies nos dieron insignificativas
> Ejemplo interpretacion: para el D21 se obtuvieron -5.31 puntos porcentuales (menos) que el D22 (que es l
> a base)
> para el D30 se obtuvieron 14.89 puntos porcentuales mas que el D22 (base) 
> Todas SIEMPRE se deben comparar con DUMMY 22, no entre sí
> Stata elige como base el que posee mayor colinealidad, sino podemos hacerlo, por ejemplo, asì
> reg ... ... D1-D15 D17-D34 (ahi omitimos el D16)*/
. *Aplicando un comando nuevo para RLM:
. xi:reg votosA gastosA gastosB fortA democa i.district
i.district        _Idistrict_1-42     (naturally coded; _Idistrict_1 omitted)

      Source |       SS       df       MS              Number of obs =     173
-------------+------------------------------           F( 37,   135) =    8.58
       Model |  33997.2977    37  918.845883           Prob > F      =  0.0000
    Residual |  14459.9509   135  107.110747           R-squared     =  0.7016
-------------+------------------------------           Adj R-squared =  0.6198
       Total |  48457.2486   172  281.728189           Root MSE      =  10.349

-------------------------------------------------------------------------------
       votosA |      Coef.   Std. Err.      t    P>|t|     [95% Conf. Interval]
--------------+----------------------------------------------------------------
      gastosA |   .0337209   .0037313     9.04   0.000     .0263414    .0411003
      gastosB |  -.0316216   .0032214    -9.82   0.000    -.0379925   -.0252507
        fortA |   .5064328   .1015841     4.99   0.000     .3055307     .707335
       democa |   8.942979   2.062472     4.34   0.000     4.864045    13.02191
 _Idistrict_2 |   3.116903   3.493071     0.89   0.374    -3.791316    10.02512
 _Idistrict_3 |   4.584348   3.527955     1.30   0.196    -2.392862    11.56156
 _Idistrict_4 |   6.320927   3.535986     1.79   0.076    -.6721656    13.31402
 _Idistrict_5 |    7.21878   3.579379     2.02   0.046     .1398698    14.29769
 _Idistrict_6 |   3.010287   3.398933     0.89   0.377    -3.711757     9.73233
 _Idistrict_7 |    7.33116    4.33952     1.69   0.093    -1.251075     15.9134
 _Idistrict_8 |   1.143463   4.318959     0.26   0.792     -7.39811    9.685036
 _Idistrict_9 |   .1101937   4.855159     0.02   0.982    -9.491817    9.712204
_Idistrict_10 |   7.636478   5.216248     1.46   0.146    -2.679656    17.95261
_Idistrict_11 |   1.851725   5.750205     0.32   0.748    -9.520412    13.22386
_Idistrict_12 |     -2.718   8.039477    -0.34   0.736    -18.61761    13.18161
_Idistrict_13 |  -7.578945   7.686412    -0.99   0.326     -22.7803    7.622413
_Idistrict_14 |   .5564392   5.683254     0.10   0.922    -10.68329    11.79617
_Idistrict_15 |  -1.676226   5.761525    -0.29   0.772    -13.07075    9.718297
_Idistrict_16 |   19.54527   10.67528     1.83   0.069    -1.567147    40.65769
_Idistrict_17 |  -5.482286   6.550581    -0.84   0.404    -18.43732    7.472749
_Idistrict_18 |  -15.87179   10.72328    -1.48   0.141    -37.07913    5.335554
_Idistrict_19 |   5.301366   5.708416     0.93   0.355    -5.988124    16.59086
_Idistrict_20 |   11.72666   10.64629     1.10   0.273    -9.328419    32.78174
_Idistrict_21 |  -11.24767   10.68693    -1.05   0.294    -32.38312     9.88779
_Idistrict_22 |  -5.927765   10.68426    -0.55   0.580    -27.05794    15.20241
_Idistrict_23 |   1.228616    5.67224     0.22   0.829    -9.989328    12.44656
_Idistrict_24 |  -3.750512   7.786519    -0.48   0.631    -19.14985    11.64883
_Idistrict_26 |  -7.445578   10.68117    -0.70   0.487    -28.56965     13.6785
_Idistrict_27 |  -4.075563   7.764174    -0.52   0.601    -19.43071    11.27958
_Idistrict_30 |   8.557309   7.722466     1.11   0.270    -6.715353    23.82997
_Idistrict_31 |   5.395754   10.69328     0.50   0.615    -15.75225    26.54376
_Idistrict_32 |   1.614419   10.69473     0.15   0.880    -19.53647     22.7653
_Idistrict_34 |   8.962284   10.64076     0.84   0.401    -12.08187    30.00643
_Idistrict_36 |  -6.654377   10.67403    -0.62   0.534    -27.76432    14.45557
_Idistrict_37 |   8.994234   10.82713     0.83   0.408    -12.41849    30.40696
_Idistrict_40 |   -20.2169    11.2961    -1.79   0.076    -42.55711    2.123305
_Idistrict_42 |  -2.071638   10.84275    -0.19   0.849    -23.51525    19.37198
        _cons |   16.85485   5.911438     2.85   0.005     5.163846    28.54586
-------------------------------------------------------------------------------

. /*Por default, omite la primer variable*/
. 
. log close
      name:  <unnamed>
       log:  C:\Users\JUAN\Google Drive\Universidad\UCEMA\Econometria\TP\TP5\clase7.log
  log type:  text
 closed on:  26 Jul 2020, 18:40:24
----------------------------------------------------------------------------------------------------------
